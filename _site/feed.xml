<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Ragalgut</title>
        <description>Un espacio para compartir conocimientos técnicos relacionados con la tecnología.</description>
        <link>http://localhost:4000/</link>
        <atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml"/>
        <pubDate>Mon, 10 Jul 2023 13:07:34 +0200</pubDate>
        <lastBuildDate>Mon, 10 Jul 2023 13:07:34 +0200</lastBuildDate>
        <generator>Jekyll v4.3.2</generator>
        
            <item>
                <title>Actualizando a una versión superior de Windows Server en una máquina virtual de Azure</title>
                <description>&lt;p&gt;Si en algún momento te has plantado actualizar la versión de &lt;strong&gt;Windows Server&lt;/strong&gt; en una máquina virtual de &lt;strong&gt;Azure&lt;/strong&gt;, probablemente hayas decidido pasar por levantar una máquina de cero con la nueva versión, posteriormente hacer una migración de roles, datos, cambios de IP, DNS, etc.&lt;/p&gt;

&lt;p&gt;En &lt;strong&gt;Azure&lt;/strong&gt; no es posible asociar una ISO a una unidad DVD/CD-ROM en una máquina virtual pero existe una alternativa que te voy a mostrar a continuación.&lt;/p&gt;

&lt;h3 id=&quot;tabla-de-contenidos&quot;&gt;Tabla de contenidos&lt;/h3&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;#arquitectura-y-contenido&quot;&gt;Arquitectura y contenido&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#requisitos&quot;&gt;Requisitos&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#creando-el-disco-de-actualización&quot;&gt;Creando el disco de actualización&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#ejecutando-upgrade-a-windows-server-2019-datacenter&quot;&gt;Ejecutando upgrade a Windows Server 2019 Datacenter&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;arquitectura-y-contenido&quot;&gt;Arquitectura y contenido&lt;/h2&gt;

&lt;p&gt;El escenario sobre el que voy a trabajar tiene la siguiente infraestructura, un grupo de recursos &lt;em&gt;upgradeWS&lt;/em&gt;, con una red virtual &lt;em&gt;upgradeWS-vnet (10.1.0.0/24)&lt;/em&gt;, dos máquinas virtuales, una &lt;em&gt;vmDomainSRV&lt;/em&gt; es un controlador de dominio con &lt;strong&gt;Windows Server 2019 Datacenter&lt;/strong&gt; y &lt;em&gt;vmFileSRV&lt;/em&gt; tiene el rol de servidor de ficheros con &lt;strong&gt;Windows Server 2016 Datacenter&lt;/strong&gt;. Actualizaré &lt;em&gt;vmFileSRV&lt;/em&gt; a &lt;strong&gt;Windows Server 2019 Datacenter&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/100723/infraestructure-upgrade-windows-server-azure.svg&quot; alt=&quot;Escenario del laboratorio&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;requisitos&quot;&gt;Requisitos&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;Actualmente se admite la actualización a &lt;strong&gt;Windows Server 2016&lt;/strong&gt;, &lt;strong&gt;2019&lt;/strong&gt; y &lt;strong&gt;2022&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;La versión mínima funcional para la actualización es &lt;strong&gt;Windows Server 2012&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Las versiones no admitidas para una actualización son &lt;strong&gt;Windows Server 2008 R2 Standard&lt;/strong&gt; y &lt;strong&gt;Datacenter&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;El disco del sistema operativo debe tener suficiente espacio libre para la actualizacón, mínimo 32 GB.&lt;/li&gt;
  &lt;li&gt;El software antivirus y firewall deben estar deshabilitados porque pueden interferir durante el proceso de actualización y producir errores.&lt;/li&gt;
  &lt;li&gt;La máquina virtual debe estar configurada para la licencia por volumen de &lt;strong&gt;Windows Server&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;El disco de la máquina virtual debe ser administrador, de lo contrario se debe migrar a discos administrados.&lt;/li&gt;
  &lt;li&gt;Realizar un snapshot de los discos de la máquina virtual antes de comenzar con el proceso de actualización para, en caso de error, volver al estado anterior de la máquina virtual.&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Seguir la ruta de actualizaciones admitidas:&lt;/p&gt;

    &lt;table&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;th&gt;Actualización desde / a&lt;/th&gt;
          &lt;th&gt;Windows Server 2012 R2&lt;/th&gt;
          &lt;th&gt;Windows Server 2016&lt;/th&gt;
          &lt;th&gt;Windows Server 2019&lt;/th&gt;
          &lt;th&gt;Windows Server 2022&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        &lt;tr&gt;
          &lt;td&gt;Windows Server 2012&lt;/td&gt;
          &lt;td&gt;Sí&lt;/td&gt;
          &lt;td&gt;Sí&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td&gt;Windows Server 2012 R2&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
          &lt;td&gt;Sí&lt;/td&gt;
          &lt;td&gt;Sí&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td&gt;Windows Server 2016&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
          &lt;td&gt;Sí&lt;/td&gt;
          &lt;td&gt;Sí&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td&gt;Windows Server 2019&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
          &lt;td&gt;-&lt;/td&gt;
          &lt;td&gt;Sí&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;creando-el-disco-de-actualización&quot;&gt;Creando el disco de actualización&lt;/h2&gt;

&lt;p&gt;Para poder iniciar el proceso de actualización, mediante un script de &lt;strong&gt;PowerShell&lt;/strong&gt; crearemos un disco de actualización que vendrá preparado con una imagen de &lt;strong&gt;Windows Server&lt;/strong&gt; configurada para realizar la actualización del sistema operativo. Este disco de actualización debe estar conectado a la máquina virtual y se puede utilizar para actualizar las máquinas virtuales que sean necesarias, pero, de una en una. Este script también puede ser ejecutado desde &lt;strong&gt;Azure Cloud Shell (PowerShell)&lt;/strong&gt;.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;resourceGroup&lt;/th&gt;
      &lt;th&gt;Nombre del grupo de recursos donde se creará el disco administrado de actualización. Si no existe, se crea el grupo de recursos con nombre.&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;ubicación&lt;/td&gt;
      &lt;td&gt;Región de Azure en la que se crea el disco administrado de actualización. Debe ser la misma región que la máquina virtual que se va a actualizar.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;zona&lt;/td&gt;
      &lt;td&gt;Zona de Azure en la región seleccionada donde se creará el disco administrado de actualización. Debe estar en la misma zona que la máquina virtual que se va a actualizar. En el caso de las máquinas virtuales regionales (no zonales), el parámetro de zona debe ser “”.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;diskName&lt;/td&gt;
      &lt;td&gt;Nombre del disco administrado que contendrá el disco de actualización&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;sku&lt;/td&gt;
      &lt;td&gt;Versión del disco de actualización de Windows Server. Debe ser &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;server2016Upgrade&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;server2019Upgrade&lt;/code&gt; o &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;server2022Upgrade&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;strong&gt;Script de PowerShell&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Customer specific parameters &lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Resource group of the source VM&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$resourceGroup&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;WindowsServerUpgrades&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Location of the source VM&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$location&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;WestUS2&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Zone of the source VM, if any&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$zone&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Disk name for the that will be created&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$diskName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;WindowsServer2022UpgradeDisk&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Target version for the upgrade - must be either server2022Upgrade or server2019Upgrade&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$sku&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;server2022Upgrade&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;


&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Common parameters&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$publisher&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;MicrosoftWindowsServer&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$offer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;WindowsServerUpgrade&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$managedDiskSKU&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Standard_LRS&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Get the latest version of the special (hidden) VM Image from the Azure Marketplace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$versions&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-AzVMImage&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-PublisherName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$publisher&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Location&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$location&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Offer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$offer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Skus&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$sku&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sort-object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Descending&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Version&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$latestString&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$versions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Version&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;


&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Get the special (hidden) VM Image from the Azure Marketplace by version - the image is used to create a disk to upgrade to the new version&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;


&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$image&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-AzVMImage&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Location&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$location&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;                       &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-PublisherName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$publisher&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;                       &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Offer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$offer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;                       &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Skus&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$sku&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;                       &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Version&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$latestString&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Create Resource Group if it doesn&apos;t exist&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-not&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-AzResourceGroup&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$resourceGroup&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SilentlyContinue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;New-AzResourceGroup&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$resourceGroup&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Location&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$location&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;    
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Create Managed Disk from LUN 0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$zone&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$diskConfig&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;New-AzDiskConfig&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SkuName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$managedDiskSKU&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;                                   &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-CreateOption&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;FromImage&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;                                   &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Zone&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$zone&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;                                   &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Location&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$location&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$diskConfig&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;New-AzDiskConfig&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SkuName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$managedDiskSKU&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;                                   &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-CreateOption&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;FromImage&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;                                   &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Location&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$location&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 

&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Set-AzDiskImageReference&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Disk&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$diskConfig&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$image&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Lun&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;New-AzDisk&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ResourceGroupName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$resourceGroup&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;           &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-DiskName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$diskName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;           &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Disk&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$diskConfig&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Tras ejecutar el script la consola de &lt;strong&gt;Cloud Shell&lt;/strong&gt; me devuelve la siguiente salida:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/100723/outputs-azure-cloud-shell.webp&quot; alt=&quot;Salida Azure Cloud Shell&quot; /&gt;&lt;/p&gt;

&lt;p&gt;El disco ha sido creado, como podemos observar con una capacidad de 10GB, suficiente para contener los archivos para la actualización a &lt;strong&gt;Windows Server 2019 Datacenter&lt;/strong&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/100723/azure-disk-upgrade-windows-server-2019-datacenter.webp&quot; alt=&quot;Disco de datos para la actualización a Windows Server 2019 Datacenter&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Una vez adjuntado el disco a la máquina virtual podemos ver que contiene una carpeta con la versión de &lt;strong&gt;Windows Server&lt;/strong&gt; a la cual vamos actualizar y los archivos para la actualización:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/100723/files-upgrade-to-windows-server-2019-datacenter.webp&quot; alt=&quot;Archivos para la actualización a Windows Server 2019 Datacenter&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;ejecutando-upgrade-a-windows-server-2019-datacenter&quot;&gt;Ejecutando upgrade a Windows Server 2019 Datacenter&lt;/h2&gt;

&lt;p&gt;Para comenzar el proceso de actualización tenemos que abrir una consola de &lt;strong&gt;PowerShell&lt;/strong&gt; en la máquina que queremos ejecutar esta y situanos en el directorio donde se encuentran los archivos para la actualización del sistema operativo, en mi caso es &lt;em&gt;F:\Windows Server 2019&lt;/em&gt; y ejecutar el siguiente comando:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\setup.exe&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;/auto&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;upgrade&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;/dynamicupdate&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;disable&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Se abrirá el asistente de instalación de &lt;strong&gt;Windows Server XXXX&lt;/strong&gt;, seleccionamos la edición a la que queremos actualizar:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/100723/windows-server-2019-setup.webp&quot; alt=&quot;Asistente de instalación Windows Server 2019&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Comenzará el proceso de actualización:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/100723/installing-windows-server-2019.webp&quot; alt=&quot;Actualizando a Windows Server 2019&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Si durante el proceso de instalación se reinicia la máquina perderemos la conexión y podremos visualizar el proceso de actualización desde los diagnósticos de arranque en &lt;strong&gt;Azure&lt;/strong&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/100723/bootdiagnostics-windows-server-2019-setup.webp&quot; alt=&quot;Diagnósticos de arranque actualización a Windows Server 2019&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Una vez finalizado el proceso de actualización y tengamos disponible nuestra máquina virtual, podremos observar que esta ya se encuentra actualizada con la nueva versión de &lt;strong&gt;Windows Server&lt;/strong&gt;, mantiene toda la información y roles, además que seguirá unida al dominio.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/100723/findstr.webp&quot; alt=&quot;Comprobando el dominio de la máquina virtual&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Si el proceso de actualización falla y la máquina entra en un estado de inactividad (no arranca), podremos restaurar el snapshot realizado antes del upgrade y repetir el proceso.&lt;/p&gt;
</description>
                <pubDate>Mon, 10 Jul 2023 10:00:00 +0200</pubDate>
                <link>http://localhost:4000/windows</link>
                <guid isPermaLink="true">http://localhost:4000/windows</guid>
                
                <category>Azure</category>
                
                <category>Windows Server</category>
                
                
            </item>
        
            <item>
                <title>Automatizar despliegues en Azure con Terraform y GitHub Actions</title>
                <description>&lt;p&gt;La mejor forma de hacer despliegues con &lt;strong&gt;Terraform&lt;/strong&gt; es automatizar todo el proceso que va desde &lt;em&gt;terraform init&lt;/em&gt; a &lt;em&gt;terraform apply&lt;/em&gt;, con un proceso previo de aprobación antes de aplicar los cambios y una conexión a &lt;strong&gt;Azure&lt;/strong&gt; haciendo uso de identidades federadas para &lt;strong&gt;OpenID&lt;/strong&gt; con el objetivo de no almacenar credenciales en &lt;strong&gt;GitHub&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;En este artículo os muestro como automatizar despliegues de infraestructura en &lt;strong&gt;Azure&lt;/strong&gt; con &lt;strong&gt;módulos de Terraform&lt;/strong&gt; usando un workflow de &lt;strong&gt;GitHub Actions&lt;/strong&gt;, descargando los módulos a través de &lt;strong&gt;SSH&lt;/strong&gt; y realizando la conexión con identidades federada para &lt;strong&gt;OpenID&lt;/strong&gt;.&lt;/p&gt;

&lt;h3 id=&quot;tabla-de-contenidos&quot;&gt;Tabla de contenidos&lt;/h3&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;#arquitectura-y-contenido&quot;&gt;Arquitectura y contenido&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#configurar-backend-en-azure&quot;&gt;Configurar backend en Azure&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#configurar-identidades-federadas-para-openid&quot;&gt;Configurar identidades federadas para OpenID&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#configurar-clave-pública-y-privada&quot;&gt;Configurar clave pública y privada&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#crear-entornos-en-github&quot;&gt;Crear entornos en GitHub&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#agregar-secretos-en-github&quot;&gt;Agregar secretos en GitHub&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#puesta-en-marcha-del-workflow&quot;&gt;Puesta en marcha del workflow&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;arquitectura-y-contenido&quot;&gt;Arquitectura y contenido&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/images/280623/diagrama.svg&quot; alt=&quot;Arquitectura&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Los recursos que vamos a crear en &lt;strong&gt;Azure&lt;/strong&gt; para poner en marcha este escenario son un grupo de recursos &lt;em&gt;lab-rg&lt;/em&gt;, una cuenta de almacenamiento &lt;em&gt;labaztfbackend&lt;/em&gt; y un contenedor privado &lt;em&gt;tbackend&lt;/em&gt;. En el contenedor &lt;em&gt;tbackend&lt;/em&gt; es donde va a estar almacenado el archivo de estado &lt;em&gt;terraform.tfstate&lt;/em&gt; con la infraestructura de &lt;strong&gt;Azure&lt;/strong&gt; gestionada por &lt;strong&gt;Terraform&lt;/strong&gt;. En &lt;strong&gt;Azure AD&lt;/strong&gt; también hay que crear un registro de aplicación &lt;em&gt;tf-sp-terraform&lt;/em&gt;, configurar dos identidades federadas &lt;em&gt;plan&lt;/em&gt; y &lt;em&gt;apply&lt;/em&gt; para &lt;strong&gt;OpenID Connect&lt;/strong&gt; y dar permisos de colaborador al registro de aplicación &lt;em&gt;tf-sp-terraform&lt;/em&gt; sobre la suscripción para que pueda crear, eliminar o administrar los recursos de &lt;strong&gt;Azure&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Con un workflow de &lt;strong&gt;GitHub Actions&lt;/strong&gt; vamos automatizar el despliegue de un grupo de recursos llamado &lt;em&gt;rg-test00&lt;/em&gt; con las etiquetas &lt;em&gt;test5&lt;/em&gt; y &lt;em&gt;test6&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;El siguiente repositorio &lt;a href=&quot;https://github.com/ragalgut/az-tf-deployment-oidc&quot;&gt;az-tf-deployment-oidc&lt;/a&gt; es la plantilla que vamos a usar para trabajar este escenario. Para usar la plantilla: &lt;em&gt;Use this template&lt;/em&gt; &amp;gt; &lt;em&gt;Create a new repository&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/280623/usar-template.webp&quot; alt=&quot;Usar plantilla de GitHub&quot; /&gt;&lt;/p&gt;

&lt;p&gt;En el raiz del repositorio se encuentran los ficheros &lt;em&gt;main.tf&lt;/em&gt; y &lt;em&gt;terraform.tfvars&lt;/em&gt; donde está el código de &lt;strong&gt;Terraform&lt;/strong&gt; del proyecto que vamos a desplegar, en este caso un grupo de recursos con un &lt;a href=&quot;https://github.com/ragalgut/az-tf-module-resource-group&quot;&gt;módulo de Terraform&lt;/a&gt;.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/ragalgut/az-tf-deployment-oidc/blob/main/main.tf&quot;&gt;Código archivo main.tf&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/ragalgut/az-tf-deployment-oidc/blob/main/terraform.tfvars&quot;&gt;Código archivo terraform.tfvars&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;La ejecución del workflow se realiza desde el apartado &lt;em&gt;Actions&lt;/em&gt; en &lt;strong&gt;GitHub&lt;/strong&gt;.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/ragalgut/az-tf-deployment-oidc/blob/main/.github/workflows/tf-plan-apply.yml&quot;&gt;Código del workflow&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;configurar-backend-en-azure&quot;&gt;Configurar backend en Azure&lt;/h2&gt;

&lt;p&gt;Tenemos que crear en &lt;strong&gt;Azure&lt;/strong&gt; un backend donde estará alojado el archivo de estado &lt;em&gt;terraform.tfstate&lt;/em&gt; con la infraestructura de &lt;strong&gt;Azure&lt;/strong&gt; gestionada por &lt;strong&gt;Terraform&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Hay que crear una cuenta de almacenamiento y un contenedor privado. Para este escenario creo una cuenta de almacenamiento llamada &lt;em&gt;labaztfbackend&lt;/em&gt; y un contenedor &lt;em&gt;tbackend&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/280623/cuenta-de-almacenamiento-azure.webp&quot; alt=&quot;Azure Storage Account&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Posteriormente tendremos que editar el siguiente bloque de nuestro código &lt;em&gt;main.tf&lt;/em&gt; y agregar el nombre del grupo de recursos, cuenta de almacenamiento y contenedor que hemos creado:&lt;/p&gt;

&lt;div class=&quot;language-terraform highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nx&quot;&gt;backend&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;azurerm&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;resource_group_name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;lab-rg&quot;&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;# Nombre del grupo de recursos donde se encuentra la cuenta de almacenamiento&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;storage_account_name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;labaztfbackend&quot;&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;# Nombre de la cuenta de almacenamiento donde se va almacenar el fichero de estado&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;container_name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;tbackend&quot;&lt;/span&gt;               &lt;span class=&quot;c1&quot;&gt;# Nombre del container donde se va almacenar el fichero de estado&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;terraform.tfstate&quot;&lt;/span&gt;                 &lt;span class=&quot;c1&quot;&gt;# Nombre del fichero de estado. El nombre estándar es terraform.tfstate&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Referencia: &lt;a href=&quot;https://github.com/ragalgut/az-tf-deployment-oidc/blob/main/main.tf#L27-L32&quot;&gt;https://github.com/ragalgut/az-tf-deployment-oidc/blob/main/main.tf#L27-L32&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;configurar-identidades-federadas-para-openid&quot;&gt;Configurar identidades federadas para OpenID&lt;/h2&gt;

&lt;p&gt;Para la creación de una identidad federada para &lt;strong&gt;OpenID&lt;/strong&gt; hay que crear un registro de aplicación en &lt;strong&gt;Azure AD&lt;/strong&gt;. Para este escenario creo uno llamado &lt;em&gt;tf-sp-terraform&lt;/em&gt; con acceso ‘&lt;em&gt;Solo cuentas de este directorio organizativo (solo de Default Directory: inquilino único)&lt;/em&gt;’.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/280623/registro-de-aplicacion.webp&quot; alt=&quot;Azure App Registration&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Posteriormente creamos dos identidades federadas del tipo entorno, yo las he llamado &lt;em&gt;plan&lt;/em&gt; y &lt;em&gt;apply&lt;/em&gt;. En el workflow hay dos jobs configurados, uno encargado de realizar &lt;em&gt;Terraform Plan&lt;/em&gt; y otro encargado de realizar &lt;em&gt;Terraform Apply&lt;/em&gt;, cada uno de estos jobs tienen configurado un entorno en &lt;strong&gt;GitHub&lt;/strong&gt;, también llamados &lt;em&gt;plan&lt;/em&gt; y &lt;em&gt;apply&lt;/em&gt;, este último configurado con un proceso previo de aprovación para que podamos verificar el plan y poder aprobar o rechazar los cambios. La identidad federada que crearemos en &lt;strong&gt;Azure&lt;/strong&gt; será de tipo entorno para que los jobs validen correctamente con &lt;strong&gt;Azure&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Para crear una identidad federada accedemos al registro de aplicación creado anteriormente &amp;gt; &lt;em&gt;Certificados y secretos&lt;/em&gt; &amp;gt; &lt;em&gt;Credenciales federadas&lt;/em&gt; &amp;gt; &lt;em&gt;Agregar credencial&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/280623/credenciales-federadas-plan-apply-azure-openid.webp&quot; alt=&quot;Credenciales federadas para OpenID&quot; /&gt;&lt;/p&gt;

&lt;p&gt;El escenario que tenemos que seleccionar es &lt;em&gt;Acciones de GitHub que implementan recursos de Azure&lt;/em&gt;, la &lt;em&gt;Organización&lt;/em&gt; es nuestro usuario de &lt;strong&gt;github.com&lt;/strong&gt;, en el caso de &lt;strong&gt;GitHub Enterprise&lt;/strong&gt; es el nombre de la organización, en &lt;em&gt;Repositorio&lt;/em&gt; el nombre de nuestro repositorio, &lt;em&gt;Tipo de entidad&lt;/em&gt; seleccionamos &lt;em&gt;Entorno&lt;/em&gt; y por último indicamos el nombre de la identidad.&lt;/p&gt;

&lt;p&gt;El &lt;em&gt;Identificador de sujeto&lt;/em&gt; y &lt;em&gt;Api token&lt;/em&gt; que se muestra en la configuración es la que usa &lt;strong&gt;github.com&lt;/strong&gt;. Para &lt;strong&gt;GitHub Enterprise&lt;/strong&gt; hay que consultar con el administrador cual es el identificador y el api token y configurarlo en la identidad federada en &lt;strong&gt;Azure&lt;/strong&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Cuando se ejecuta el workflow y da un fallo en la etapa de conexión con OpenID se puede ver en los logs cual es el identificador y api token que espera encontrar.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/images/280623/crear-credencial.webp&quot; alt=&quot;Crear credencial&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Por último tenemos que &lt;strong&gt;dar permisos de colaborador al registro de aplicación creado, en mi caso &lt;em&gt;tf-sp-terraform&lt;/em&gt; sobre la suscripción que queremos administrar con Terraform&lt;/strong&gt;.&lt;/p&gt;

&lt;h2 id=&quot;crear-entornos-en-github&quot;&gt;Crear entornos en GitHub&lt;/h2&gt;

&lt;p&gt;Para crear los dos entornos en &lt;strong&gt;GitHub&lt;/strong&gt; vamos en nuestro repositorio a &lt;em&gt;Settings&lt;/em&gt; &amp;gt; &lt;em&gt;Environments&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/280623/github-environments-plan-apply.webp&quot; alt=&quot;Entornos GitHub&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Creamos un nuevo entorno desde &lt;em&gt;New environment&lt;/em&gt; y le damos un nombre, para este escenario lo he llamado &lt;em&gt;plan&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/280623/new-environment-github.webp&quot; alt=&quot;Nuevo entorno GitHub&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Hay que tener en cuenta que el nombre del entorno de &lt;strong&gt;GitHub&lt;/strong&gt; debe coincidir con el nombre del entorno configurado en la identidad federada para que pueda hacer conexión, además en este escenario se espera que los nombres sean &lt;em&gt;plan&lt;/em&gt; y &lt;em&gt;apply&lt;/em&gt; porque están configurados en cada job en el código del workflow. Referencia: &lt;a href=&quot;https://github.com/ragalgut/az-tf-deployment-oidc/blob/main/.github/workflows/tf-plan-apply.yml#L23&quot;&gt;plan&lt;/a&gt;, &lt;a href=&quot;https://github.com/ragalgut/az-tf-deployment-oidc/blob/main/.github/workflows/tf-plan-apply.yml#L92&quot;&gt;apply&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;El entorno &lt;em&gt;apply&lt;/em&gt; debe tener marcada la opción &lt;em&gt;Required reviewers&lt;/em&gt; y agregar un reviewer para el proceso de aprobación del job &lt;em&gt;Terraform Apply&lt;/em&gt;, podemos ser nosotros mismos.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/280623/required-reviewers-environment-apply.webp&quot; alt=&quot;Required reviewers environment GitHub&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;configurar-clave-pública-y-privada&quot;&gt;Configurar clave pública y privada&lt;/h2&gt;

&lt;p&gt;Para que &lt;em&gt;terraform init&lt;/em&gt; pueda clonar el repositorio del módulo por &lt;strong&gt;SSH&lt;/strong&gt; tenemos que generar un par de claves, la privada estará encriptada como variable en un secreto de &lt;strong&gt;GitHub&lt;/strong&gt; y la pública estará unida en nuestro perfil de usuario. Este proceso lo detallo más adelante.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ssh-keygen -t rsa
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;agregar-secretos-en-github&quot;&gt;Agregar secretos en GitHub&lt;/h2&gt;

&lt;p&gt;En el workflow hay configurado una serie de variables que &lt;strong&gt;GitHub&lt;/strong&gt; espera obtener la información del repositorio de secretos, por lo tanto, tenemos que crearlos.&lt;/p&gt;

&lt;p&gt;Referencia: &lt;a href=&quot;https://github.com/ragalgut/az-tf-deployment-oidc/blob/main/.github/workflows/tf-plan-apply.yml#L13-L16&quot;&gt;varibales en el workflow&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Para crear los secretos, tenemos que ir desde nuestro repositorio a &lt;em&gt;Settings&lt;/em&gt; &amp;gt; &lt;em&gt;Secrets and variables&lt;/em&gt; &amp;gt; &lt;em&gt;Actions&lt;/em&gt; &amp;gt; &lt;em&gt;New repository secret&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/280623/secrets-github.webp&quot; alt=&quot;Secrets GitHub&quot; /&gt;&lt;/p&gt;

&lt;p&gt;A continuación en la siguiente tabla proporciono la información que debeís agregar en cada campo:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Name&lt;/th&gt;
      &lt;th&gt;Secret&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;AZURE_CLIENT_ID&lt;/td&gt;
      &lt;td&gt;El ID del registro de aplicación creado (cliente)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;AZURE_SUBSCRIPTION_ID&lt;/td&gt;
      &lt;td&gt;ID de la suscripción a gestionar con Terraform&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;AZURE_TENANT_ID&lt;/td&gt;
      &lt;td&gt;ID del tenant de Azure. Este ID también se puede obtener de la información del registro de aplicación&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;GIT_SSH_COMMAND&lt;/td&gt;
      &lt;td&gt;ssh -o StrictHostKeyChecking=no -i $HOME/.ssh/id_rsa&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SSH_KEY_GITHUB_ACTIONS&lt;/td&gt;
      &lt;td&gt;Clave privada del par de claves generados anteriormente&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;blockquote&gt;
  &lt;p&gt;Al copiar la clave privada debemos tener en cuenta que debe incluir las líneas completas &lt;em&gt;BEGIN OPENSSH PRIVATE KEY&lt;/em&gt; y &lt;em&gt;END OPENSSH PRIVATE KEY&lt;/em&gt;. Además debe haber una línea en blanco al final del todo.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Por último hay que configurar la clave pública en nuestra cuenta de usuario en &lt;em&gt;Settings&lt;/em&gt; &amp;gt; &lt;em&gt;SSH and GPG keys&lt;/em&gt; &amp;gt; &lt;em&gt;New SSH key&lt;/em&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;La clave pública debe tener el formato indicado y una línea en blanco al final.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;puesta-en-marcha-del-workflow&quot;&gt;Puesta en marcha del workflow&lt;/h2&gt;

&lt;p&gt;Para poner en marcha el workflow y ejecutar el despliegue en &lt;strong&gt;Azure&lt;/strong&gt; tenemos que ir a &lt;em&gt;Actions&lt;/em&gt; &amp;gt; &lt;em&gt;Terraform Plan/Apply&lt;/em&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/280623/ejecutar-workflow-github-actions.webp&quot; alt=&quot;Ejecutar workflow GitHub Actions&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Comenzará la ejecución del workflow, ejecutará cada job y sus diferentes etapas siempre que no exista un error en una de ellas. Si accedemos al workflow que está en ejecución podemos ver más detalles del job que se está ejecutando y los que están en espera.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/280623/ejecutar-workflow-github-actions02.webp&quot; alt=&quot;Ejecutar workflow GitHub Actions&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Aquí podemos ver ambos jobs &lt;em&gt;Terraform Plan&lt;/em&gt; y &lt;em&gt;Terraform Apply&lt;/em&gt;. Las lineas azules de los jobs hacen referencia a las etapas ejecutadas. Para tener más detalles de las etapas que se están ejecutando accedemos al job &lt;em&gt;Terraform Plan&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/280623/ejecutar-workflow-github-actions03.webp&quot; alt=&quot;Ejecutar workflow GitHub Actions&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Aquí podemos ver las etapas que están en proceso, completadas o con error. Si desplegamos &lt;em&gt;Terraform Plan&lt;/em&gt; podemos tener el detalle de los recursos que se van a desplegar en &lt;strong&gt;Azure&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/280623/ejecutar-workflow-github-actions04.webp&quot; alt=&quot;Ejecutar workflow GitHub Actions&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Aquí podemos ver que se va a desplegar un grupo de recursos con el nombre &lt;em&gt;rg-test00&lt;/em&gt; con dos etiquetas &lt;em&gt;test5&lt;/em&gt; y &lt;em&gt;test6&lt;/em&gt;. El siguiente paso es aprobar o rechazar este despliegue, para ello vamos al job &lt;em&gt;Terraform Apply&lt;/em&gt; que está pendiente de aprobación.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/280623/ejecutar-workflow-github-actions05.webp&quot; alt=&quot;Ejecutar workflow GitHub Actions&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Para aprobar o rechazar tenemos que hacer clic en &lt;em&gt;Review pending deployments&lt;/em&gt; y marcamos la acción que queramos llevar a cabo, en este escenario voy aprobar el despliegue.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/280623/ejecutar-workflow-github-actions07.webp&quot; alt=&quot;Ejecutar workflow GitHub Actions&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Una vez finalizadas las etapas podemos ver que los recursos se han desplegado correctamente en &lt;strong&gt;Azure&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/280623/ejecutar-workflow-github-actions08.webp&quot; alt=&quot;Ejecutar workflow GitHub Actions&quot; /&gt;&lt;/p&gt;
</description>
                <pubDate>Wed, 28 Jun 2023 10:00:00 +0200</pubDate>
                <link>http://localhost:4000/automatizar-despliegues-en-azure-con-terraform-y-github-actions</link>
                <guid isPermaLink="true">http://localhost:4000/automatizar-despliegues-en-azure-con-terraform-y-github-actions</guid>
                
                <category>Terraform</category>
                
                <category>Azure</category>
                
                <category>GitHub</category>
                
                <category>OpenID</category>
                
                
            </item>
        
            <item>
                <title>Creando un sitio web estático con Jekyll y GitHub</title>
                <description>&lt;p&gt;En este artículo voy a mostrar paso a paso como crear un sitio web estático con &lt;strong&gt;Jekyll&lt;/strong&gt; desde un equipo con &lt;strong&gt;Windows 11&lt;/strong&gt; y como alojarlo en un repositorio de &lt;strong&gt;GitHub&lt;/strong&gt;. No me voy a extender mucho en el uso de &lt;strong&gt;Jekyll&lt;/strong&gt;, para ello he adjuntado unos enlaces de interés a la documentación oficial, me centraré en la creación del sitio y el correspondiente despliegue en &lt;strong&gt;GitHub&lt;/strong&gt;.&lt;/p&gt;

&lt;h2 id=&quot;tabla-de-contenidos&quot;&gt;Tabla de contenidos&lt;/h2&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;#arquitectura-como-trabajar-con-jekyll-y-github&quot;&gt;Arquitectura, como trabajar con Jekyll y GitHub&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#prerequisitos&quot;&gt;Prerequisitos&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#instalar-jekyll&quot;&gt;Instalar Jekyll&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#enlaces-de-interés-jekyll&quot;&gt;Enlaces de interés Jekyll&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#publicar-sitio-en-github&quot;&gt;Publicar sitio en GitHub&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#desplegar-sitio-en-github-pages&quot;&gt;Desplegar sitio en GitHub Pages&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#configurar-un-dominio-personalizado&quot;&gt;Configurar un dominio personalizado&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;arquitectura-como-trabajar-con-jekyll-y-github&quot;&gt;Arquitectura, como trabajar con Jekyll y GitHub&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/images/arquitectura-jekyll-github-pages.svg&quot; alt=&quot;Sitio validado y publicado&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Jekyll&lt;/strong&gt; permite ejecutar nuestro sitio estático en un servidor local &lt;em&gt;http://localhost:4000&lt;/em&gt;. Esto nos permite revisar los cambios que aplicamos en el repositorio local en nuestro equipo antes de aplicar un commit o un push al repositorio público.&lt;/p&gt;

&lt;p&gt;Por lo tanto el repositorio local lo trato como entorno de desarrollo y el público como producción.&lt;/p&gt;

&lt;p&gt;Una vez realizado un push al repositorio público se ejecuta automáticamente un workflow de &lt;strong&gt;GitHub Actions&lt;/strong&gt; que despliega el sitio de &lt;strong&gt;Jekyll&lt;/strong&gt; en &lt;strong&gt;GitHub Pages&lt;/strong&gt;.&lt;/p&gt;

&lt;h2 id=&quot;prerequisitos&quot;&gt;Prerequisitos&lt;/h2&gt;

&lt;p&gt;Es necesario descargar e instala la última versión de &lt;strong&gt;Ruby+Devkit&lt;/strong&gt; desde el siguiente &lt;a href=&quot;https://rubyinstaller.org/downloads/&quot;&gt;enlace&lt;/a&gt;. Este conjunto de herramientas instala el lenguaje &lt;strong&gt;Ruby&lt;/strong&gt; y un entorno de ejecución.&lt;/p&gt;

&lt;p&gt;Durante la instalación nos aseguramos tener marcadas las siguientes dos opciones:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Add Ruby executables to your PATH.&lt;/li&gt;
  &lt;li&gt;Associate .rb and .rbw files with this Ruby installation.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/images/install-ruby-devkit1.webp&quot; alt=&quot;Instalación Ruby+Devkit&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Y también los siguientes componentes para la instalación:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Ruby-3.2.2 base files.&lt;/li&gt;
  &lt;li&gt;Ruby RI and HTML documentation.&lt;/li&gt;
  &lt;li&gt;MSYS2 development toolchain 2023-04-01.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/images/install-ruby-devkit2.webp&quot; alt=&quot;Instalación Ruby+Devkit&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Tras finalizar la instalación dejamos marcado “&lt;em&gt;Run ridk install&lt;/em&gt;” para que arranque la instalación de &lt;em&gt;MSYS2 y las herramientas de desarrollo&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/install-ruby-devkit3.webp&quot; alt=&quot;Instalación Ruby+Devkit&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Por último tenemos que instalar el componente &lt;em&gt;3 - MSYS2 and MINGW development toochain&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/install-ruby-devkit4.webp&quot; alt=&quot;Instalación Ruby+Devkit&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;instalar-jekyll&quot;&gt;Instalar Jekyll&lt;/h2&gt;

&lt;p&gt;Los comandos que facilito a continuación se ejecutan &lt;strong&gt;desde una consola CMD&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Lo primero que tenemos que hacer es &lt;strong&gt;instalar Jekyll&lt;/strong&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;gem install jekyll bundler
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;El siguiente comando sirve para comprobar la &lt;strong&gt;versión de Jekyll&lt;/strong&gt; instalada:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;jekyll -v command
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Para &lt;strong&gt;crear&lt;/strong&gt; un nuevo blog o &lt;strong&gt;sitio estático&lt;/strong&gt; ejecutamos el siguiente comando:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;jekyll new myblog
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Para &lt;strong&gt;arrancar el servidor local de Jekyll&lt;/strong&gt; y visualizar el blog accedemos a la carpeta myblog y ejecutamos:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cd myblog
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bundle exec jekyll serve
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Abrimos en el navegador la siguiente URL &lt;em&gt;http://localhost:4000&lt;/em&gt; y podremos visualizar el blog.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/myblog.webp&quot; alt=&quot;Visualizar sitio estático desde servidor local de Jekyll&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;enlaces-de-interés-jekyll&quot;&gt;Enlaces de interés Jekyll&lt;/h2&gt;

&lt;p&gt;Para que podáis ampliar conocimientos sobre el uso de &lt;strong&gt;Jekyll&lt;/strong&gt; os facilito una serie de recursos de la documentación oficial que os ayudará a entender la estructura de directorios, creación de contenido, plugins y temas, entre otros.&lt;/p&gt;

&lt;h3 id=&quot;contenido&quot;&gt;Contenido&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/pages/&quot;&gt;Pages&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/posts/&quot;&gt;Post&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/front-matter/&quot;&gt;Front Matter&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/collections/&quot;&gt;Collections&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/datafiles/&quot;&gt;Data Files&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/assets/&quot;&gt;Assets&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/static-files/&quot;&gt;Static Files&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/plugins/&quot;&gt;Plugins&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;estructura-del-sitio&quot;&gt;Estructura del sitio&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/structure/&quot;&gt;Structure&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/liquid/&quot;&gt;Liquid&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/variables/&quot;&gt;Variables&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/includes/&quot;&gt;Includes&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/layouts/&quot;&gt;Layouts&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/permalinks/&quot;&gt;Permalinks&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/themes/&quot;&gt;Themes&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/pagination/&quot;&gt;Pagination&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;publicar-sitio-en-github&quot;&gt;Publicar sitio en GitHub&lt;/h2&gt;

&lt;p&gt;Para publicar nuestro sitio estático en &lt;strong&gt;GitHub&lt;/strong&gt; seguimos los siguientes pasos:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Crear un repositorio en GitHub&lt;/strong&gt;.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/create-new-public-repository-github.webp&quot; alt=&quot;Crear repositorio público en GitHub&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Clonamos nuestro repositorio&lt;/strong&gt; en un directorio local de nuestro equipo. Yo hago uso de &lt;a href=&quot;https://code.visualstudio.com/&quot;&gt;Visual Studio Code&lt;/a&gt;, pero también existen otras herramientas que facilitan la gestión de repositorios de &lt;strong&gt;GitHub&lt;/strong&gt; como &lt;a href=&quot;create-new-public-repository-github.png&quot;&gt;GitHub Desktop&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Copiamos el contenido&lt;/strong&gt; de nuestro sitio al repositorio clonado.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Hacemos commit de todos los cambios&lt;/strong&gt; y posteriormente un &lt;strong&gt;push&lt;/strong&gt; para que se suba el contenido al repositorio público.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/push-myblog-jekyll.webp&quot; alt=&quot;Contenido del sitio en repositorio público&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;desplegar-sitio-en-github-pages&quot;&gt;Desplegar sitio en GitHub Pages&lt;/h2&gt;

&lt;p&gt;Una vez tenemos nuestro sitio público en &lt;strong&gt;GitHub&lt;/strong&gt; tenemos que configurar &lt;strong&gt;GitHub Pages&lt;/strong&gt; para que muestre el sitio web en un dominio de &lt;strong&gt;GitHub&lt;/strong&gt;. Para ello vamos a &lt;em&gt;Settings &amp;gt; Pages&lt;/em&gt; desde el repositorio público.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/settings-github-pages.webp&quot; alt=&quot;Configurar GitHub Pages&quot; /&gt;&lt;/p&gt;

&lt;p&gt;En &lt;em&gt;source&lt;/em&gt; seleccionamos &lt;strong&gt;GitHub Actions&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/source-github-pages.webp&quot; alt=&quot;Configurar GitHub Pages&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Seleccionamos configurar &lt;strong&gt;Jekyll&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/configure-jekyll-github-pages.webp&quot; alt=&quot;Desplegar Jekyll en GitHub Pages&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Por último hacemos &lt;em&gt;commit&lt;/em&gt; para aplicar el workflow que &lt;strong&gt;GitHub Actions&lt;/strong&gt; nos facilita para el despliegue del sitio de &lt;strong&gt;Jekyll&lt;/strong&gt; en &lt;strong&gt;GitHub Pages&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/commit-actions-github-pages.webp&quot; alt=&quot;Desplegar Jekyll en GitHub Pages&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;configurar-un-dominio-personalizado&quot;&gt;Configurar un dominio personalizado&lt;/h2&gt;

&lt;p&gt;El dominio que viene por defecto para &lt;strong&gt;GitHub Pages&lt;/strong&gt; tiene el siguiente formato [usuarioGitHub].github.io.
   Si queremos agregar nuestro propio dominio, en mi caso ragalgut.me, tenemos que agregar los siguientes registros en la configuración DNS de nuestro proveedor de dominio.&lt;/p&gt;

&lt;p&gt;Crear los siguientes &lt;strong&gt;registros A&lt;/strong&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;   185.199.108.153
   185.199.109.153
   185.199.110.153
   185.199.111.153
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Crear los siguientes &lt;strong&gt;registros AAA&lt;/strong&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;   72606:50c0:8000::153
   2606:50c0:8001::153
   2606:50c0:8002::153
   2606:50c0:8003::153
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Crear un &lt;strong&gt;registro CNAME&lt;/strong&gt; en la que el subdominio sea &lt;strong&gt;www&lt;/strong&gt; y el destino &lt;strong&gt;[usuarioGitHub].github.io&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/config-dns-zone-github-pages.webp&quot; alt=&quot;Configurar zona DNS en proveedor de dominio&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Configuramos el dominio personalizado en &lt;em&gt;Settings &amp;gt; Pages&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/custom-domain-github-pages.webp&quot; alt=&quot;Configurar dominio personalizado GitHub Pages&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Tras validar el dominio personalizado el sitio web estará live.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/github-pages-live.webp&quot; alt=&quot;Sitio validado y publicado&quot; /&gt;&lt;/p&gt;
</description>
                <pubDate>Mon, 05 Jun 2023 14:01:35 +0200</pubDate>
                <link>http://localhost:4000/creando-un-sitio-web-estatico-con-jekyll-y-github-pages</link>
                <guid isPermaLink="true">http://localhost:4000/creando-un-sitio-web-estatico-con-jekyll-y-github-pages</guid>
                
                <category>Jekyll</category>
                
                <category>GitHub</category>
                
                
            </item>
        
            <item>
                <title>Configurar la autenticación SMTP en cuentas de Microsoft 365</title>
                <description>&lt;p&gt;&lt;strong&gt;SMTP&lt;/strong&gt; es un protocolo usado para el envío y recepción de correos presente en aplicaciones, servidores de correos, impresoras multifuncionales, formularios webs, clientes &lt;strong&gt;POP3&lt;/strong&gt; e &lt;strong&gt;IMAP4&lt;/strong&gt;, etc. El puerto que utiliza es &lt;strong&gt;TCP 587&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Las cuentas de &lt;strong&gt;Microsoft 365&lt;/strong&gt; que disponen de una licencia para &lt;strong&gt;Exchange Online&lt;/strong&gt; permiten habilitar la autenticación &lt;strong&gt;SMTP (AUTH SMTP)&lt;/strong&gt;, pero, solo se recomienda hacerlo en cuentas que lo requieran porque por defecto hacen uso de una autenticación más moderna y segura.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Si tiene habilitado los valores predeterminados de seguridad en el tenant de su empresa, AUTH SMTP está por defecto deshabilitado en todas las cuentas de Microsoft 365.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;requisitos-para-activar-o-desactivar-smtp-y-conexión-a-exchange-online-mediante-powershell&quot;&gt;Requisitos para activar o desactivar SMTP y conexión a Exchange Online mediante PowerShell&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Tener habilitada la ejecución de scripts.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Set-ExecutionPolicy RemoteSigned
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Tener instalado el módulo de &lt;strong&gt;PowerShell Exchange Online&lt;/strong&gt;.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Install-Module -Name ExchangeOnlineManagement -RequiredVersion 3.1.0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Cargamos el módulo ejecutando el siguiente comando.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Import-Module ExchangeOnlineManagement
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Para establecer una conexión como administrador con &lt;strong&gt;Exchange Online&lt;/strong&gt; ejecutamos el siguiente comando, donde &lt;em&gt;admin@contoso.com&lt;/em&gt; es la cuenta de administrador.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Connect-ExchangeOnline -UserPrincipalName admin@contoso.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;deshabilitar-autenticación-smtp-globalmente&quot;&gt;Deshabilitar autenticación SMTP globalmente&lt;/h2&gt;

&lt;p&gt;Para deshabilitar &lt;strong&gt;SMTP&lt;/strong&gt; globalmente en la empresa, ejecutamos el siguiente comando.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Set-TransportConfig -SmtpClientAuthenticationDisabled $true
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Para comprobar que se ha deshabilitado la autenticación &lt;strong&gt;SMTP&lt;/strong&gt; ejecutamos el siguiente comando y comprobamos que el valor de la propiedad &lt;em&gt;SmtpClientAuthenticationDisablede&lt;/em&gt; sea &lt;em&gt;True&lt;/em&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Get-TransportConfig | Format-List SmtpClientAuthenticationDisabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;habilitar-autenticación-smtp-en-cuentas-específicas&quot;&gt;Habilitar autenticación SMTP en cuentas específicas&lt;/h2&gt;

&lt;p&gt;Para comprobar la configuración actual de la cuenta de usuario ejecutamos el siguientes comando, donde &lt;em&gt;usuario@contoso.com&lt;/em&gt; introducimos la cuenta de usuario a revisar.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Get-CASMailbox -Identity Usuario@contoso.com | Format-List SmtpClientAuthenticationDisabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Si nos carga el usuario con el valor en blanco o &lt;em&gt;$True&lt;/em&gt; ejecutamos el siguiente comando para habilitar la autenticación &lt;strong&gt;SMTP&lt;/strong&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Set-CASMailbox -Identity sean@contoso.com -SmtpClientAuthenticationDisabled $false 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Referencia:&lt;/strong&gt; &lt;a href=&quot;https://docs.microsoft.com/es-es/exchange/clients-and-mobile-in-exchange-online/authenticated-client-smtp-submission&quot;&gt;Microsoft Learn&lt;/a&gt;&lt;/p&gt;
</description>
                <pubDate>Wed, 24 May 2023 14:01:35 +0200</pubDate>
                <link>http://localhost:4000/configurar-la-autenticacion-smtp-en-cuentas-de-microsoft-365</link>
                <guid isPermaLink="true">http://localhost:4000/configurar-la-autenticacion-smtp-en-cuentas-de-microsoft-365</guid>
                
                <category>Microsoft 365</category>
                
                <category>Exchange Online</category>
                
                
            </item>
        
    </channel>
</rss>